@using WebMatrix.Data

@{ 
    // hier geef je aan dat je de layout wilt gebruiken
    Layout = "~/_SiteLayout.cshtml";

    // hier maak je de benodigde variabelen aan.
    //login
    var LoginUser = "";
    var LoginPassword = "";
    //GuestCode
    var LoginCode = ""; 
    //Register
    bool pwvalidation = true;
    var RegisterEmail = "";
    var RegisterPassword = "";
    var Name = "";
    var RegisterPasswordConfirm = "";
    var hashed = "";
    var sha256 = "";
    var sha1 = "";
    var salt = "";
    var RegisterhashedPassword = "";
    //Password Reset
    var ResetEmail = "";


    //LoginForm
    {
        // hier zet je validatie messages voor als iemand iets niet invult.
        Validation.RequireField("LoginUser", "Voer je gebruikersnaam adres in.");
        Validation.RequireField("Password", "Voer je wachtwoord in.");

        // hiermee kunnen gebruikers inloggen
        if (IsPost)
        {
            // Haal email en wachtwoord vaue op uit form
            LoginUser = Request.Form["Email"];
            LoginPassword = Request.Form["Password"];

            if (Validation.IsValid())
            {
                // hier open je de database
                string connectionString = @"Data Source=(LocalDB)\MSSQLLocalDB;AttachDbFilename=|DataDirectory|\General.mdf;Integrated Security=True";
                string provider = "System.Data.SqlClient";
                Database db = Database.OpenConnectionString(connectionString, provider);

                // hier haal je het wachtwoord op wat in de database staat
                var hashedPassword = db.QueryValue("SELECT Password FROM Account WHERE LOWER(Email) = LOWER(@0)", LoginUser);
                hashedPassword.ToString();

                // zet bool checkPassword
                var checkPassword = false;
                // Vergelijk de gehashte values van het opgehaalde wachtwoord en het opgegeven wachtwoord
                checkPassword = Crypto.VerifyHashedPassword(hashedPassword, LoginPassword);

                // hier kijk je of je wachtwoord klopt
                if (checkPassword == true)
                {
                    // Zet sessions
                    Session["LoggedIn"] = "Yes";
                    Session["Username"] = db.QueryValue("SELECT Email FROM Account WHERE LOWER(Email) = LOWER(@0)", LoginUser);
                    Session["UniqueCode"] = db.QueryValue("SELECT Code FROM Account WHERE LOWER(Email) = LOWER(@0)", LoginUser);
                    Session["Id"] = db.QueryValue("SELECT id FROM Account WHERE LOWER(Email) = LOWER(@0)", LoginUser);

                    // stuurt gebruiker terug naar de volgende pagina
                    Response.Redirect("~/cshtml/BruidCadeau");
                }
            }

        }
    }

    //GuestCode
    {

        // hiermee kunnen gasten inloggen
        // hier haal je het id op van het account
        String selectLoginCode = "SELECT id FROM Account WHERE Code = @0";
        if (!Request.QueryString["searchCode"].IsEmpty())
        {
            if (Validation.IsValid())
            {
                string connectionString = @"Data Source=(LocalDB)\MSSQLLocalDB;AttachDbFilename=|DataDirectory|\General.mdf;Integrated Security=True";
                string provider = "System.Data.SqlClient";
                Database db = Database.OpenConnectionString(connectionString, provider);

                // je maakt de variabele selectedLoginCode, en zoekt je het id wat bij de gast login code hoort
                var selectedLoginCode = db.QueryValue(selectLoginCode, Request.QueryString["searchCode"]);

                // Zet sessions
                Session["GuestLoggedIn"] = "Yes";
                Session["userID"] = selectedLoginCode;

                // stuurt gebruiker terug naar de volgende pagina
                Response.Redirect("~/cshtml/GastCadeau?id=@" + selectedLoginCode);
            }
            else
            {
                Response.Redirect("~/cshtml/Homepage");
            }
        }
    }

    //Register
    {
        // hier zijn de validatie berichten voor als het niet goed gaat
        Validation.RequireField("Email", "Voer een email adres in.");
        Validation.RequireField("Name", "Voer een naam in.");
        Validation.RequireField("Password", "Voer een wachtwoord in.");

        if (IsPost && Validation.IsValid())
        {
            // als alles correct is ingevuld 
            RegisterEmail = Request.Form["Email"];
            RegisterPassword = Request.Form["Password"];
            Name = Request.Form["Name"];
            RegisterPasswordConfirm = Request.Form["PasswordConfirm"];

            // als beide wachtwoorden hetzelfde zijn gaat hij verder
            if (RegisterPasswordConfirm == RegisterPassword)
            {
                // hier wordt het wachtwoord geencrypt
                RegisterPassword = Request.Form["Password"];
                hashed = Crypto.Hash(RegisterPassword, "MD5");
                sha256 = Crypto.SHA256(RegisterPassword);
                sha1 = Crypto.SHA1(RegisterPassword);
                salt = Crypto.GenerateSalt();
                RegisterhashedPassword = Crypto.HashPassword(RegisterPassword);

                // hier opent hij de database
                string connectionString = @"Data Source=(LocalDB)\MSSQLLocalDB;AttachDbFilename=|DataDirectory|\General.mdf;Integrated Security=True";
                string provider = "System.Data.SqlClient";
                Database db = Database.OpenConnectionString(connectionString, provider);

                // hier vult hij alles in in de database
                var insertCommand = "INSERT INTO Account (Email, Password, Name, Code) Values(@0, @1, @2, @3)";
                db.Execute(insertCommand, RegisterEmail, RegisterhashedPassword, Name, Guid.NewGuid());
                Response.Redirect("~/cshtml/Homepage.cshtml");
            }

            else
            {
                pwvalidation = false;
            }
        }
    }

    //ResetPassword
    {
        Validation.RequireField("ResetEmail", "Voer je email adres in.");

        ResetEmail = Request.Form["fp_email"];
    }


}
<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!--<script src="https://code.jquery.com/jquery-1.11.1.min.js"></script> -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <link rel="stylesheet" href="~/Content/login.css">
    <script src="~/Scripts/login.js"></script>
    <!--<link href='css files/login2.css' rel='stylesheet' type='text/css'> -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <title>Login a Special Day</title>
</head>
<body>

</body>
</html>
<!-- LOGIN FORM -->
<div class="text-center" style="padding:50px 0">
    <div class="logo">login</div>
    <!-- Main Form -->
    <div class="login-form-1">
        <form id="login-form" class="text-left">
            <div class="login-form-main-message"></div>
            <div class="main-login-form">
                <div class="login-group">
                    <div class="form-group">
                        <label for="lg_username" class="sr-only">Gebruikersnaam</label>
                        <input type="text" class="form-control" id="lg_username" name="lg_username" placeholder="gebruikersnaam">
                    </div>
                    <div class="form-group">
                        <label for="lg_password" class="sr-only">Wachtwoord</label>
                        <input type="password" class="form-control" id="lg_password" name="lg_password" placeholder="wachtwoord">
                    </div>
                    <div class="form-group login-group-checkbox">
                        <input type="checkbox" id="lg_remember" name="lg_remember">
                        <label for="lg_remember">onthoud</label>
                    </div>
                </div>
                <button type="button" onclick="location.href = 'Index.cshtml'" class="login-button"><i class="fa fa-chevron-right"></i></button>
            </div>
        </form>
    </div>
    <!-- end:Main Form -->
</div>
<!-- Code Input Form-->
<div class="text-center" style="padding:50px 0"></div>
<div class="logo">Uitnodigings code</div>
<div class="login-form-1">
    <form id="forgot-password-form" class="text-left">
        <div class="etc-login-form">
            <p>Hier kun je de code invoeren die je van het bruidspaar hebt gekregen.</p>
        </div>
        <div class="login-form-main-message"></div>
        <div class="main-login-form">
            <div class="login-group">
                <div class="form-group">
                    <label for="fp_email" class="sr-only">Uitnodigings Code</label>
                    <input type="text" class="form-control" id="fp_email" name="fp_email" placeholder="Uitnodigings Code">
                </div>
            </div>
            <button type="button" onclick="location.href = 'Index.cshtml'" class="login-button"><i class="fa fa-chevron-right"></i></button>
        </div>
    </form>
</div>
<!-- REGISTRATION FORM -->
<div class="text-center" style="padding:50px 0">
    <div class="logo">registreer</div>
    <!-- Main Form -->
    <div class="login-form-1">
        <form id="register-form" class="text-left">
            <div class="login-form-main-message"></div>
            <div class="main-login-form">
                <div class="login-group">
                    <div class="form-group">
                        <label for="reg_username" class="sr-only">Email adres</label>
                        <input type="text" class="form-control" id="reg_username" name="reg_username" placeholder="Gebruikersnaam">
                    </div>
                    <div class="form-group">
                        <label for="reg_password" class="sr-only">Wachtwoord</label>
                        <input type="password" class="form-control" id="reg_password" name="reg_password" placeholder="wachtwoord">
                    </div>
                    <div class="form-group">
                        <label for="reg_password_confirm" class="sr-only">bevestig wachtwoord</label>
                        <input type="password" class="form-control" id="reg_password_confirm" name="reg_password_confirm" placeholder="bevestig wachtwoord">
                    </div>

                    <div class="form-group">
                        <label for="reg_email" class="sr-only">Email</label>
                        <input type="text" class="form-control" id="reg_email" name="reg_email" placeholder="email">
                    </div>
                    <div class="form-group">
                        <label for="reg_fullname" class="sr-only">Volledige naam</label>
                        <input type="text" class="form-control" id="reg_fullname" name="reg_fullname" placeholder="volledige naam">
                    </div>

                    <div class="form-group login-group-checkbox">
                        <input type="radio" class="" name="reg_gender" id="male" placeholder="gebruikersnaam">
                        <label for="male">man</label>

                        <input type="radio" class="" name="reg_gender" id="female" placeholder="gebruikersnaam">
                        <label for="female">vrouw</label>
                    </div>
                </div>
                <button type="button" onclick="location.href = 'Index.cshtml'" class="login-button"><i class="fa fa-chevron-right"></i></button>
            </div>
        </form>
    </div>
    <!-- end:Main Form -->
</div>

<!-- FORGOT PASSWORD FORM -->
<div class="text-center" style="padding:50px 0">
    <div class="logo">wachtwoord vergeten</div>
    <!-- Main Form -->
    <div class="login-form-1">
        <form id="forgot-password-form" class="text-left">
            <div class="etc-login-form">
                <p>Als je hier je email adres invoert worden er instructies verzonden die vertellen hoe je je wachtwoord reset.</p>
            </div>
            <div class="login-form-main-message"></div>
            <div class="main-login-form">
                <div class="login-group">
                    <div class="form-group">
                        <label for="fp_email" class="sr-only">Email address</label>
                        <input type="text" class="form-control" id="fp_email" name="fp_email" placeholder="email adres">
                    </div>
                </div>
                <button type="button" onclick="location.href = 'Index.cshtml'" class="login-button"><i class="fa fa-chevron-right"></i></button>
            </div>
        </form>
    </div>
    <!-- end:Main Form -->
</div>